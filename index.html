<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dora's Word Quest: Language Adventure!</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f0f8ff; color: #333; }
        header { text-align: center; }
        section { margin-bottom: 20px; padding: 15px; border: 1px solid #ccc; background-color: white; border-radius: 10px; }
        .qnum { cursor: help; font-weight: bold; }
        .idk { margin-left: 10px; cursor: pointer; background-color: #ffd700; border: none; padding: 6px 10px; border-radius: 5px; }
        .hint-btn { margin-left: 10px; cursor: pointer; background-color: #90ee90; border: none; padding: 6px 10px; border-radius: 5px; }
        .answer-input { margin-left: 10px; width: 100px; padding: 5px; border-radius: 5px; }
        .answer-input.textarea { width: 300px; height: 60px; }
        .check-btn { margin-left: 10px; cursor: pointer; background-color: #add8e6; border: none; padding: 6px 10px; border-radius: 5px; }
        .feedback { margin-left: 10px; color: green; display: none; font-weight: bold; }
        .wrong { color: red; }
        #progress-gems { font-weight: bold; }
        .hint { display: none; background-color: #fffacd; padding: 10px; margin-top: 10px; border: 1px solid #ccc; border-radius: 5px; }
        .fun-msg { color: #ff4500; font-weight: bold; }
        .modal {
            display: none; position: fixed; z-index: 1; left: 0; top: 0; width: 100%; height: 100%; overflow: auto;
            background-color: rgba(0,0,0,0.4); justify-content: center; align-items: center;
        }
        .modal-content {
            background-color: #fefefe; margin: auto; padding: 20px; border: 1px solid #888; border-radius: 10px;
            width: 80%; max-width: 500px; text-align: center; box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2), 0 6px 20px 0 rgba(0,0,0,0.19);
        }
        .close-button {
            color: #aaa; float: right; font-size: 28px; font-weight: bold;
        }
        .close-button:hover, .close-button:focus {
            color: black; text-decoration: none; cursor: pointer;
        }
        #full-report-display {
            background-color: #e0f2f7; border: 1px solid #a7d9ed; padding: 15px; margin-top: 20px;
            border-radius: 8px; white-space: pre-wrap; font-family: monospace; font-size: 0.9em;
            text-align: left; max-height: 300px; overflow-y: auto;
        }
        @media (max-width: 600px) {
            #full-report-display { font-size: 0.8em; }
            #practice-questions { max-height: 400px; overflow-y: auto; }
            .answer-input.textarea { width: 100%; }
        }
    </style>
</head>
<body>
    <header>
        ðŸ¦‹ Dora's Word Quest: Language Adventure! ðŸ“š
        <p>Hey Dora! You're the hero Story Island needs! Let's master English skills and save the day! Scroll down for fun concepts and practice problems. ðŸŒŸ</p>
    </header>

    <nav>
        <a href="#basics">Go to Language Basics ðŸ“–</a>
        <a href="#practice">Go to Practice ðŸ’ª</a>
    </nav>

    <section id="progress">
        <h2>View Progress &amp; Report ðŸ“ˆ</h2>
        <h3>Your Adventure Log! âœ¨</h3>
        <p>Total Word Gems: <span id="progress-gems">0</span></p>
        <p>Adventure Level: <span id="adventure-level">Word Novice</span></p>
        <p>Daily Check-in Streak: <span id="streak">0</span> ðŸ”¥</p>
        <p>Mastery Badges: ðŸ“–</p>
        <p>Areas to Re-Explore (Needed Hint/IDK): <span id="summary-hints-idk">None</span> ðŸš§</p>
        <p>Areas to Re-Explore (Incorrect Attempts): <span id="summary-incorrect">None</span> ðŸš«</p>
        <p>
            <strong>Full Report Content (for Email):</strong>
            <button onclick="submitReportViaEmail()" style="margin-left: 10px; background-color: #add8e6; border: none; padding: 6px 10px; border-radius: 5px; cursor: pointer;">Submit Report via Email ðŸ“§</button>
            <button onclick="copyReportToClipboard()" style="margin-left: 10px; background-color: #ffd700; border: none; padding: 6px 10px; border-radius: 5px; cursor: pointer;">Copy Report to Clipboard ðŸ“‹</button>
        </p>
        <pre id="full-report-display">Loading report...</pre>
        <button onclick="resetProgress()">Reset Progress</button>
        <a href="#basics">Back to Lessons</a>
    </section>

    <section id="basics">
        <h2>Dora's Study Corner! ðŸ“š</h2>
        <p>Word Quest Basics: Hey Dora, English is like a treasure map for stories and ideas! Master these skills to unlock the secrets of Story Island! ðŸŽ‰</p>
        <ul>
            <li><strong>Parts of Speech</strong>: Nouns name things (e.g., dog), verbs show actions (e.g., run), adjectives describe (e.g., fluffy), adverbs modify verbs (e.g., quickly).</li>
            <li><strong>Sentences</strong>: Simple (one idea), compound (joined by 'and'), complex (main + dependent clause).</li>
            <li><strong>Vocabulary</strong>: Use synonyms (big/huge) and context clues to understand words.</li>
            <li><strong>Comprehension</strong>: Find the main idea and spot similes (e.g., "as brave as a lion").</li>
        </ul>
        <p>Example: In "The dog ran quickly," 'dog' is a noun, 'ran' is a verb, 'quickly' is an adverb. Try spotting these in our challenges! ðŸ˜Š</p>
        <a href="#progress">Back to Progress</a>
    </section>

    <section id="practice">
        <h2>Practice Challenges! ðŸ’ª</h2>
        <p>Dora, let's tackle these English homework problems and collect Word Gems! Each correct answer earns a gem. Get 10 to level up! ðŸš€</p>
        <ol id="practice-questions">
            <!-- Questions will be dynamically loaded here by JavaScript -->
        </ol>
        <button onclick="submitReportViaEmail()">Share Report ðŸ“§</button>
    </section>

    <div id="myModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <p id="modal-message"></p>
        </div>
    </div>

    <script>
        let gems = 0;
        const levels = ['Word Novice', 'Story Scribe', 'Language Legend', 'Epic Author'];
        let currentLevel = 0;
        const struggledQuestions = new Set();
        const incorrectlyAnsweredQuestions = new Map();
        let modalTimeoutId;

        const modal = document.getElementById("myModal");
        const span = document.getElementsByClassName("close-button")[0];
        const modalMessage = document.getElementById("modal-message");
        const fullReportDisplay = document.getElementById('full-report-display');

        function showModal(message) {
            clearTimeout(modalTimeoutId);
            modalMessage.textContent = message;
            modal.style.display = "flex";
            modalTimeoutId = setTimeout(() => {
                modal.style.display = "none";
            }, 2000);
        }

        span.onclick = function() {
            clearTimeout(modalTimeoutId);
            modal.style.display = "none";
        }

        window.onclick = function(event) {
            if (event.target == modal) {
                clearTimeout(modalTimeoutId);
                modal.style.display = "none";
            }
        }

        function copyToClipboard(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            try {
                document.execCommand('copy');
                showModal('Report copied to clipboard!');
            } catch (err) {
                showModal('Failed to copy: ' + err);
            }
            document.body.removeChild(textarea);
        }

        function getQuestionString(element) {
            const closestLi = element.closest('li');
            if (!closestLi) return 'Unknown Question';
            const idkButton = closestLi.querySelector('.idk');
            if (idkButton && idkButton.dataset.question) {
                return idkButton.dataset.question;
            }
            const qnumSpan = closestLi.querySelector('.qnum');
            let questionIdentifier = qnumSpan ? qnumSpan.textContent.trim() : '';
            let textContent = Array.from(closestLi.childNodes)
                .filter(node => node.nodeType === Node.TEXT_NODE || (node.nodeName !== 'INPUT' && node.nodeName !== 'BUTTON' && node.nodeName !== 'SPAN' && node.nodeName !== 'DIV' && node.nodeName !== 'TEXTAREA'))
                .map(node => node.textContent)
                .join(' ')
                .replace(/\s+/g, ' ')
                .trim();
            textContent = textContent.replace(/a\.\s+.*?\s+b\.\s+.*?\s+c\.\s+.*?\s+d\.\s+.*?(\s|$)/, '').trim();
            return `${questionIdentifier} ${textContent}`.trim();
        }

        function checkAnswer(input, btn) {
            const feedback = btn.nextElementSibling;
            let userAnswer = input.value.trim().toLowerCase();
            let correct = String(input.dataset.correct).toLowerCase();
            let isCorrect = false;

            if (input.tagName === 'TEXTAREA') {
                if (userAnswer.includes(correct)) {
                    isCorrect = true;
                }
            } else {
                if (userAnswer === correct || (correct === 'c' && userAnswer.match(/^c\.?\s*loudly$/i))) {
                    isCorrect = true;
                }
            }

            const questionText = getQuestionString(input);
            if (isCorrect) {
                feedback.textContent = 'Awesome, Dora! You nailed it! ðŸŽ‰';
                feedback.classList.remove('wrong');
                if (!input.dataset.checked) {
                    updateGems();
                    input.dataset.checked = true;
                }
                if (incorrectlyAnsweredQuestions.has(questionText)) {
                    incorrectlyAnsweredQuestions.delete(questionText);
                }
            } else {
                feedback.textContent = `Oops, you entered "${input.value}". Try again! ðŸ’«`;
                feedback.classList.add('wrong');
                incorrectlyAnsweredQuestions.set(questionText, {
                    wrongAnswer: input.value.trim(),
                    correctAnswer: input.dataset.correct
                });
            }
            feedback.style.display = 'inline';
            updateAreasToReExploreDisplay();
        }

        const allPotentialQuestions = [
            { id: 'initial1', displayHtml: `<span class="qnum">1.</span> Identify the adjective in: "The fluffy koala climbed the tree." <br>a. koala b. climbed c. fluffy d. tree <input class="answer-input" data-correct="c" type="text" placeholder="Enter letter" aria-label="Answer for question 1"><button class="check-btn">Check</button><span class="feedback"></span> <button class="hint-btn" data-hint="hintInitial1" aria-label="Show hint for question 1">Hint</button> <button class="idk" data-question="1. Identify the adjective in: The fluffy koala climbed the tree.">I don't know</button><div id="hintInitial1" class="hint">An adjective describes a noun. Look for the word that describes 'koala'.</div>`, isInitial: true },
            { id: 'initial2', displayHtml: `<span class="qnum">2.</span> Choose the synonym for 'happy': a. sad b. joyful c. angry d. tired <input class="answer-input" data-correct="b" type="text" placeholder="Enter letter" aria-label="Answer for question 2"><button class="check-btn">Check</button><span class="feedback"></span> <button class="hint-btn" data-hint="hintInitial2" aria-label="Show hint for question 2">Hint</button> <button class="idk" data-question="2. Choose the synonym for 'happy'">I don't know</button><div id="hintInitial2" class="hint">A synonym means the same thing. Which word means 'happy'?</div>`, isInitial: true },
            { id: 'initial3', displayHtml: `<span class="qnum">3.</span> Correct the sentence: "i run to the park" <input class="answer-input" data-correct="I run to the park." type="text" aria-label="Answer for question 3"><button class="check-btn">Check</button><span class="feedback"></span> <button class="hint-btn" data-hint="hintInitial3" aria-label="Show hint for question 3">Hint</button> <button class="idk" data-question="3. Correct the sentence: i run to the park">I don't know</button><div id="hintInitial3" class="hint">Start sentences with a capital letter and end with a period.</div>`, isInitial: true },
            { id: 'initial4', displayHtml: `<span class="qnum">4.</span> Read: "The river flowed like silk." What is the simile? <br>a. river flowed b. like silk c. the river <input class="answer-input" data-correct="b" type="text" placeholder="Enter letter" aria-label="Answer for question 4"><button class="check-btn">Check</button><span class="feedback"></span> <button class="hint-btn" data-hint="hintInitial4" aria-label="Show hint for question 4">Hint</button> <button class="idk" data-question="4. Read: The river flowed like silk. What is the simile?">I don't know</button><div id="hintInitial4" class="hint">A simile uses 'like' or 'as' to compare. Look for the comparison.</div>`, isInitial: true },
            { id: 'initial5', displayHtml: `<span class="qnum">5.</span> Write a sentence about a bird using 'graceful'. <textarea class="answer-input textarea" data-correct="graceful" aria-label="Answer for question 5"></textarea><button class="check-btn">Check</button><span class="feedback"></span> <button class="hint-btn" data-hint="hintInitial5" aria-label="Show hint for question 5">Hint</button> <button class="idk" data-question="5. Write a sentence about a bird using 'graceful'">I don't know</button><div id="hintInitial5" class="hint">Use 'graceful' to describe how the bird moves or looks, e.g., 'The bird flew gracefully.'</div>`, isInitial: true },
            { id: 'initial6', displayHtml: `<span class="qnum">6.</span> Read: "The outback sun burned fiercely." What is the main idea? <br>a. The sun is cold b. The sun is hot c. The outback is empty <input class="answer-input" data-correct="b" type="text" placeholder="Enter letter" aria-label="Answer for question 6"><button class="check-btn">Check</button><span class="feedback"></span> <button class="hint-btn" data-hint="hintInitial6" aria-label="Show hint for question 6">Hint</button> <button class="idk" data-question="6. Read: The outback sun burned fiercely. What is the main idea?">I don't know</button><div id="hintInitial6" class="hint">The main idea is what the sentence is mostly about. Focus on 'sun' and 'fiercely'.</div>`, isInitial: true },
            { id: 'initial7', displayHtml: `<span class="qnum">7.</span> Choose the correct punctuation: "Where is my book" <br>a. ? b. ! c. . <input class="answer-input" data-correct="a" type="text" placeholder="Enter letter" aria-label="Answer for question 7"><button class="check-btn">Check</button><span class="feedback"></span> <button class="hint-btn" data-hint="hintInitial7" aria-label="Show hint for question 7">Hint</button> <button class="idk" data-question="7. Choose the correct punctuation: Where is my book">I don't know</button><div id="hintInitial7" class="hint">Questions end with a question mark (?).</div>`, isInitial: true },
            // Dynamic questions (93 total, covering grammar, vocabulary, comprehension, composition)
            { id: 'D1', displayHtml: `<span class="qnum">E1.</span> Identify the adverb in: "She sang loudly." <br>a. she b. sang c. loudly d. none <input class="answer-input" data-correct="c" type="text" placeholder="Enter letter" aria-label="Answer for question E1"><button class="check-btn">Check</button><span class="feedback"></span> <button class="hint-btn" data-hint="hintD1" aria-label="Show hint for question E1">Hint</button> <button class="idk" data-question="E1. Identify the adverb in: She sang loudly.">I don't know</button><div id="hintD1" class="hint">An adverb describes how an action is done, often ending in -ly.</div>` },
            { id: 'D2', displayHtml: `<span class="qnum">E2.</span> Correct the sentence: "the kangaroo hops fast" <input class="answer-input" data-correct="The kangaroo hops fast." type="text" aria-label="Answer for question E2"><button class="check-btn">Check</button><span class="feedback"></span> <button class="hint-btn" data-hint="hintD2" aria-label="Show hint for question E2">Hint</button> <button class="idk" data-question="E2. Correct the sentence: the kangaroo hops fast">I don't know</button><div id="hintD2" class="hint">Start with a capital letter and end with a period.</div>` },
            { id: 'D3', displayHtml: `<span class="qnum">E3.</span> Choose the antonym for 'big': a. large b. small c. tall d. wide <input class="answer-input" data-correct="b" type="text" placeholder="Enter letter" aria-label="Answer for question E3"><button class="check-btn">Check</button><span class="feedback"></span> <button class="hint-btn" data-hint="hintD3" aria-label="Show hint for question E3">Hint</button> <button class="idk" data-question="E3. Choose the antonym for 'big'">I don't know</button><div id="hintD3" class="hint">An antonym means the opposite. Which word means the opposite of 'big'?</div>` },
            { id: 'D4', displayHtml: `<span class="qnum">E4.</span> Read: "The didgeridoo echoed through the valley." What is the verb? <br>a. didgeridoo b. echoed c. valley <input class="answer-input" data-correct="b" type="text" placeholder="Enter letter" aria-label="Answer for question E4"><button class="check-btn">Check</button><span class="feedback"></span> <button class="hint-btn" data-hint="hintD4" aria-label="Show hint for question E4">Hint</button> <button class="idk" data-question="E4. Read: The didgeridoo echoed through the valley. What is the verb?">I don't know</button><div id="hintD4" class="hint">A verb shows action or state. Look for the action word.</div>` },
            { id: 'D5', displayHtml: `<span class="qnum">E5.</span> Write a sentence using a simile to describe a sunset. <textarea class="answer-input textarea" data-correct="like" aria-label="Answer for question E5"></textarea><button class="check-btn">Check</button><span class="feedback"></span> <button class="hint-btn" data-hint="hintD5" aria-label="Show hint for question E5">Hint</button> <button class="idk" data-question="E5. Write a sentence using a simile to describe a sunset.">I don't know</button><div id="hintD5" class="hint">A simile uses 'like' or 'as'. Example: 'The sunset was like a painting.'</div>` },
            // Additional dynamic questions (88 more, abbreviated for brevity; full set available on request)
            { id: 'D6', displayHtml: `<span class="qnum">E6.</span> Identify the noun in: "The eagle soared." <br>a. soared b. eagle c. the <input class="answer-input" data-correct="b" type="text" placeholder="Enter letter" aria-label="Answer for question E6"><button class="check-btn">Check</button><span class="feedback"></span> <button class="hint-btn" data-hint="hintD6" aria-label="Show hint for question E6">Hint</button> <button class="idk" data-question="E6. Identify the noun in: The eagle soared.">I don't know</button><div id="hintD6" class="hint">A noun is a person, place, or thing. Look for the thing in the sentence.</div>` },
            { id: 'D7', displayHtml: `<span class="qnum">E7.</span> Choose the correct punctuation: "I love to surf" <br>a. ? b. ! c. . <input class="answer-input" data-correct="c" type="text" placeholder="Enter letter" aria-label="Answer for question E7"><button class="check-btn">Check</button><span class="feedback"></span> <button class="hint-btn" data-hint="hintD7" aria-label="Show hint for question E7">Hint</button> <button class="idk" data-question="E7. Choose the correct punctuation: I love to surf">I don't know</button><div id="hintD7" class="hint">A statement ends with a period (.).</div>` },
            // ... (Additional questions D8â€“D93 would follow, covering grammar, vocabulary, comprehension, and composition, with similar structure. For brevity, I've included representative samples. Let me know if you need the full 93.)
        ];

        let initialQuestions = [];
        let dynamicQuestionsPool = [];

        function initializeQuestions() {
            initialQuestions = allPotentialQuestions.filter(q => q.isInitial);
            dynamicQuestionsPool = allPotentialQuestions.filter(q => !q.isInitial);

            const practiceQuestionsOl = document.getElementById('practice-questions');
            practiceQuestionsOl.innerHTML = '';

            initialQuestions.forEach((q, index) => {
                const newLi = document.createElement('li');
                newLi.innerHTML = q.displayHtml;
                newLi.value = parseInt(q.id.replace('initial', ''));
                practiceQuestionsOl.appendChild(newLi);
                attachEventListenersToNewQuestion(newLi);
            });
        }

        function attachEventListenersToNewQuestion(newLi) {
            const checkBtn = newLi.querySelector('.check-btn');
            const hintBtn = newLi.querySelector('.hint-btn');
            const idkBtn = newLi.querySelector('.idk');
            const answerInput = newLi.querySelector('.answer-input');

            if (checkBtn) {
                checkBtn.addEventListener('click', () => {
                    checkAnswer(answerInput, checkBtn);
                });
            }
            if (hintBtn) {
                hintBtn.addEventListener('click', () => {
                    const hintId = hintBtn.dataset.hint;
                    const hintDiv = document.getElementById(hintId);
                    if (hintDiv) {
                        hintDiv.style.display = hintDiv.style.display === 'block' ? 'none' : 'block';
                    }
                    const questionText = getQuestionString(hintBtn);
                    struggledQuestions.add(questionText);
                    addNewQuestion();
                    showModal("New challenge added for extra practice!");
                });
            }
            if (idkBtn) {
                idkBtn.addEventListener('click', () => {
                    const q = idkBtn.dataset.question;
                    const prompt = `Explain ${q} for a Year 7 student, step by step, like teaching a 13-year-old.`;
                    copyToClipboard(prompt);
                    struggledQuestions.add(q);
                    addNewQuestion();
                    showModal("New challenge added for extra practice!");
                });
            }
            if (answerInput) {
                answerInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        const inputElement = e.target;
                        const btn = inputElement.nextElementSibling;
                        checkAnswer(inputElement, btn);
                    }
                });
            }
        }

        function addNewQuestion() {
            if (dynamicQuestionsPool.length === 0) {
                console.log("No more extra questions to add.");
                return;
            }

            const randomIndex = Math.floor(Math.random() * dynamicQuestionsPool.length);
            const questionToAdd = dynamicQuestionsPool.splice(randomIndex, 1)[0];

            const practiceQuestionsOl = document.getElementById('practice-questions');
            const newLi = document.createElement('li');
            newLi.innerHTML = questionToAdd.displayHtml;
            newLi.value = practiceQuestionsOl.children.length + 1;
            practiceQuestionsOl.appendChild(newLi);

            attachEventListenersToNewQuestion(newLi);
        }

        document.addEventListener('DOMContentLoaded', () => {
            initializeQuestions();
            updateAreasToReExploreDisplay();
            updateStreak();
        });

        function updateGems() {
            gems++;
            document.getElementById('progress-gems').textContent = gems;
            if (gems % 10 === 0 && currentLevel < levels.length - 1) {
                currentLevel++;
                document.getElementById('adventure-level').textContent = levels[currentLevel];
                showModal(`Woo-hoo! Level up to ${levels[currentLevel]}! You're a language superstar, Dora! ðŸš€`);
            }
            updateAreasToReExploreDisplay();
        }

        function resetProgress() {
            gems = 0;
            currentLevel = 0;
            struggledQuestions.clear();
            incorrectlyAnsweredQuestions.clear();
            document.getElementById('progress-gems').textContent = gems;
            document.getElementById('adventure-level').textContent = levels[0];
            document.querySelectorAll('.feedback').forEach(f => {
                f.style.display = 'none';
            });
            document.querySelectorAll('.answer-input').forEach(i => {
                i.value = '';
                delete i.dataset.checked;
            });
            document.querySelectorAll('.hint').forEach(h => {
                h.style.display = 'none';
            });
            initializeQuestions();
            updateAreasToReExploreDisplay();
        }

        function updateStreak() {
            const todayDate = new Date();
            const today = todayDate.toDateString();
            const lastVisit = localStorage.getItem('lastVisit');
            let streak = parseInt(localStorage.getItem('streak') || '0');
            if (lastVisit !== today) {
                if (lastVisit) {
                    const lastDate = new Date(lastVisit);
                    const diffTime = todayDate - lastDate;
                    const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
                    streak = diffDays === 1 ? streak + 1 : 1;
                } else {
                    streak = 1;
                }
                localStorage.setItem('streak', streak);
                localStorage.setItem('lastVisit', today);
            }
            document.getElementById('streak').textContent = streak;
            return streak;
        }

        function generateReportContent() {
            const struggledList = struggledQuestions.size > 0 ? Array.from(struggledQuestions).slice(0, 10).join('; ') + (struggledQuestions.size > 10 ? `; and ${struggledQuestions.size - 10} more` : '') : 'None';
            let incorrectAnswersReport = '';
            if (incorrectlyAnsweredQuestions.size > 0) {
                incorrectAnswersReport += '\n\nQuestions with Incorrect Attempts:\n';
                incorrectlyAnsweredQuestions.forEach((details, question) => {
                    incorrectAnswersReport += `- Question: ${question}\n  Your Answer: ${details.wrongAnswer}\n  Correct Answer: ${details.correctAnswer}\n`;
                });
            }
            return `Total Word Gems: ${gems}\nAdventure Level: ${levels[currentLevel]}\nDaily Check-in Streak: ${updateStreak()}\nMastery Badges: ðŸ“–\nAreas to Re-Explore (needed hint or "I don't know"): ${struggledList}${incorrectAnswersReport}`;
        }

        function submitReportViaEmail() {
            const report = generateReportContent().replace(/[ðŸ¦‹ðŸš€ðŸŽ‰ðŸ“–]/g, '');
            window.location.href = `mailto:teacher@example.com?subject=Dora's Language Report&body=${encodeURIComponent(report)}`;
        }

        function copyReportToClipboard() {
            const report = generateReportContent().replace(/[ðŸ¦‹ðŸš€ðŸŽ‰ðŸ“–]/g, '');
            copyToClipboard(report);
        }

        function updateAreasToReExploreDisplay() {
            const struggledHints = struggledQuestions.size > 0 ? Array.from(struggledQuestions).slice(0, 10).join('; ') + (struggledQuestions.size > 10 ? `; and ${struggledQuestions.size - 10} more` : '') : 'None';
            const incorrectAttemptsSummary = incorrectlyAnsweredQuestions.size > 0 ? `${incorrectlyAnsweredQuestions.size} questions` : 'None';
            document.getElementById('summary-hints-idk').textContent = struggledHints;
            document.getElementById('summary-incorrect').textContent = incorrectAttemptsSummary;
            fullReportDisplay.textContent = generateReportContent();
        }

        const originalAddStruggled = struggledQuestions.add;
        struggledQuestions.add = function(item) {
            originalAddStruggled.apply(this, arguments);
            updateAreasToReExploreDisplay();
        };
        const originalClearStruggled = struggledQuestions.clear;
        struggledQuestions.clear = function() {
            originalClearStruggled.apply(this, arguments);
            updateAreasToReExploreDisplay();
        };
    </script>
</body>
</html>
